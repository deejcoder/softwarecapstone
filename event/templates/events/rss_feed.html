{% extends 'base.html' %}

{% block content %}

<script>
    jQuery(function() {
        $("#rss-feeds").rss("https://techevents.nz/rss/all", {
            limit: 100,
            filter: function(entry, tokens) {
                var events = tokens.title.indexOf('Palmerston') > -1;
                return events;
            },
            layoutTemplate: "<ul style='list-style:none;'>{entries}</ul>",
            entryTemplate: "<li class='event-item bg-light mt-2 mb-2 p-2 border border-light rounded'><a href='{url}'>{newtitle}</a><br/>{desc}</li>",
            tokens: {
                newtitle: function(entry, tokens) {return tokens.title},
                desc: function(entry, tokens) {
                    var s = tokens.body.toString();
                    var wrapper = document.createElement('div');
                    var desc_container = document.createElement('div');
                    var date_container = document.createElement('div');
                    date_container.classList.add("font-weight-bold");
                    wrapper.innerHTML = s;
                    var strongText = wrapper.getElementsByTagName("strong");
                    var date_time = strongText[1];
                    for (var i = strongText.length - 1; 0 <= i; i--) {
                        wrapper.removeChild(strongText[i]);
                    }
                    var brs = wrapper.getElementsByTagName('br');
                    while (brs.length) {
                        brs[0].parentNode.removeChild(brs[0]);
                    }
                    desc_container.innerHTML = "<p>" + wrapper.innerText + "</p>";
                    date_container.innerHTML = "<p>" + date_time.innerText + "</p>";
                    wrapper.innerHTML = date_container.outerHTML.toString() + desc_container.outerHTML.toString();
                    return wrapper.outerHTML;
                }
            },
        })
    })
</script>
<h2>Events in Palmerston North</h2>
<div id="rss-feeds"></div>

{% endblock %}

